\section{Introduction}

Network measurement has been a fundamental component in modern networks. For example, it enables traffic monitoring and engineering in data center networks \cite{li2016flowradar,woodruff2019measuring,zhang2017high} and wide-area networks \cite{huang2017sketchvisor,liu2016one,caida}, and supports network latency monitoring in distributed large language model training scenarios \cite{qian2024alibaba}. More precisely, it measures real-time traffic statistics such as per-flow packet counts in data plane switches and periodically collects these measurement data to the control plane. The control plane offers data to network management applications for identifying the events of their interest and making corresponding decisions. 

However, existing measurement techniques face the dilemma of achieving high accuracy and resource efficiency simultaneously. More precisely, the literature has proposed two categories of measurement techniques, i.e., sketches and in-band network telemetry (INT). For sketches \cite{li2016flowradar,yang2018elastic,huang2017sketchvisor,huang2018sketchlearn,liu2016one,huang2021toward,liu2019nitrosketch,zhang2021cocosketch,namkung2022sketchlib}, they achieve accurate measurement for large flows via compact data structures. While sketches are resource-efficient, they exhibit low accuracy when measuring small flows due to the short of switch memory. For INT-based approaches \cite{sheng2021deltaint,ben2020pint,handigol2014know,pan2019int,zhu2015packet}, they record statistics within the INT headers of each packet and collect these headers at the egress of networks. Although their per-packet monitoring achieves full accuracy, it imposes high pressure on network bandwidth and control plane resources to handle large volumes of INT data. 

Although recent studies attempt to break the above dilemma, they come at additional cost. Some of them propose sophisticated sketches such as elastic sketches \cite{yang2018elastic} and pyramid sketches \cite{yang2017pyramid} that distinguish the measurement of small flows from large flows to mitigate the errors originated from hashing collisions. However, they involve complex data structures and operations, which hinder their hardware implementation, and also require time-consuming parameter tuning. Also, a lot of optimizations aim at reducing INT overheads via strategies like path planning \cite{pan2019int} or probabilistic updating \cite{ben2020pint}. Nevertheless, given the large volume of large flows, massive packets collectively force INT to generate a high-speed stream of INT headers, which brings non-trivial pressure to the control plane. 

Hereby, we issue the following question: how can we achieve accurate and resource-efficient measurement towards both large and short flows? Our answer is \sysname, which is an accurate and resource-efficient measurement framework. Our core idea originates from our observation: sketches and INT techniques are \emph{complementary} to each other. More precisely, sketches trade their accuracy of measuring small flows for resource efficiency at scale, while INT techniques trade their resource efficiency for full accuracy of measuring every flow. Hence, their advantages and limitations lead to the possible match: for traffic in modern networks, which is considered skewed (i.e., most packets come from a few large flows) \cite{roy2015inside,huang2021toward,caida,benson2010network,yang2018elastic}, \sysname leverages sketches to measure large flows while using INT techniques to measure small flows, maximizing both accuracy and efficiency.

\para{Contributions}. However, co-designing sketches and INT techniques within the same system faces the fundamental challenges of \emph{where}, \emph{how}, and \emph{how efficiently} to deploy these techniques. In response, we design \sysname to bridge the accuracy-efficiency gap by systematically integrating sketches and INT. Our major contributions are summarized as follows.  

\begin{itemize}[leftmargin=*]
%
    \item[1] \emph{Near-optimal measurement point selection}. Given a network and a set of orientation-destination (OD) pairs, each of which represents the ingress and egress of a specific flow, \sysname chooses enough switches to place sketches and INT. It aims at maximizing the coverage of measured flows and minimizing the distance between the switches where flows are measured and the control plane where traffic statistics are collected and analyzed. Next, it formulates such an optimization as a multi-objective facility location problem and leverages Lagrangian relaxation to obtain near-optimal decisions. 
%
    \item[2] \emph{Congestion-free measurement data transmission}. At runtime, according to its decisions, \sysname runs sketches and INT on selected switches. Sketches periodically report their data of large flows to the control plane, while INT utilizes every packet of small flows to transfer data. To prevent these techniques from producing a high-speed stream of measurement data that causes congestion, \sysname profiles the maximum possible rate of sending measurement data from every switch to the control plane. According to profiling results, it decides which paths to transfer data with a provably high probability of avoiding congestion. 
%
    \item[3] \emph{Accurate and resource-efficient measurement data reduction}. Directly emitting a large volume of measurement data to the control plane in a short time can easily saturate control plane resources, while existing approaches \cite{chen2021mtp} are inefficient since they fail to change their static allocation to deal with traffic dynamics. In response, \sysname incorporates a suite of data reduction techniques, i.e., merging similar data, only sending data delta, and data caching, into its data collection to reduce the amount of measurement data by orders of magnitude. 
%
    \item[4] \emph{Real-world implementation and evaluation}. We have implemented \sysname on a testbed that comprises $64\times 400$\,Gbps Tofino2 switches \cite{tofino2}. Our testbed experiments indicate that \sysname outperforms existing standalone sketches or INT techniques with significant accuracy improvement (e.g., $3\times$ F1 score) and orders-of-magnitude lower overheads. 
%
\end{itemize}

